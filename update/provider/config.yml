mixed-port: 7890
allow-lan: false
mode: rule
log-level: warning
external-controller: 127.0.0.1:9090
tcp-concurrent: true
tcp-fast-open: true
udp-timeout: 120

tun:
  enable: true
  stack: system
  dns-hijack:
    - any:53
  auto-route: true
  auto-detect-interface: true
  mtu: 1500

profile:
  store-selected: true  # Remember last used proxy
  store-fake-ip: true   # Persist fake-IP mappings
  
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:5353
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16  # Explicit fake-IP range
  fake-ip-filter:
  - "*.ir"
  - "+.local"
  default-nameserver:
  - 185.51.200.2 # Shecan DNS
  - 178.22.122.100 # Shecan DNS
  - 78.157.42.100
  - 78.157.42.101
  nameserver:
  - https://94.140.14.14/dns-query
  - tls://184bd938.d.adguard-dns.com
  - https://d.adguard-dns.com/dns-query/184bd938
  - https://2tnc6zpc9c.cloudflare-gateway.com/dns-query
  - https://1.1.1.1/dns-query
  - https://dns.google/dns-query
  fallback:
  - https://doh.dns.sb/dns-query
  - https://dns.quad9.net/dns-query

  fallback-filter:
    geoip: true
    geoip-code: IR
    ipcidr:
      - 0.0.0.0/8
      - 10.0.0.0/8
      - 100.64.0.0/10
      - 127.0.0.0/8
      - 169.254.0.0/16
      - 172.16.0.0/12
      - 192.0.0.0/24
      - 192.0.2.0/24
      - 192.168.0.0/16
      - 198.18.0.0/15
      - 198.51.100.0/24
      - 203.0.113.0/24
      - 224.0.0.0/4
      - 240.0.0.0/4
      - 255.255.255.255/32

proxies:

proxy-groups:
  - name: 'Core'
    type: select
    proxies:
   
  - name: 'Ping'
    type: url-test
    url: 'http://clients3.google.com/generate_204'
    tolerance: 300
    interval: 3600
    lazy: false
    disable-udp: false
    proxies:

rule-providers:
  ir:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/ir.txt"
    path: ./ruleset/ir.txt
    interval: 604800
  ads:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/ads.txt"
    path: ./ruleset/ads.txt
    interval: 604800
  malware:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/malware.txt"
    path: ./ruleset/malware.txt
    interval: 604800
  phishing:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/phishing.txt"
    path: ./ruleset/phishing.txt
    interval: 604800
  cryptominers:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/cryptominers.txt"
    path: ./ruleset/cryptominers.txt
    interval: 604800
  apps:
    type: http
    format: text
    behavior: classical
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/apps.txt"
    path: ./ruleset/apps.txt
    interval: 604800
  ircidr:
    type: http
    format: text
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/ircidr.txt"
    path: ./ruleset/ircidr.txt
    interval: 604800
  private:
    type: http
    format: text
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/private.txt"
    path: ./ruleset/private.txt
    interval: 604800
  irasn:
    type: http
    format: text
    behavior: classical
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/irasn.txt"
    path: ./ruleset/irasn.txt
    interval: 604800
  category-ads-all:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/category-ads-all.txt"
    path: ./ruleset/category-ads-all.txt
    interval: 604800
  whitelist:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/direct.txt"
    path: ./ruleset/whitelist.txt
    interval: 604800
  blacklist:
    type: http
    format: text
    behavior: domain
    url: "https://raw.githubusercontent.com/Airuop/servers/main/rules/block.txt"
    path: ./ruleset/blacklist.txt
    interval: 604800

rules :
  - RULE-SET,private,DIRECT,no-resolve
  - RULE-SET,apps,DIRECT
  - RULE-SET,ads,REJECT
  - RULE-SET,malware,REJECT
  - RULE-SET,phishing,REJECT
  - RULE-SET,cryptominers,REJECT
  - RULE-SET,ir,DIRECT
  - RULE-SET,ircidr,DIRECT
  - RULE-SET,irasn,DIRECT
  - RULE-SET,category-ads-all,REJECT
  - RULE-SET,whitelist,DIRECT
  - RULE-SET,blacklist,REJECT
  - DOMAIN-SUFFIX,ir,DIRECT
  - DOMAIN-SUFFIX,instagram.com,Core
  - DOMAIN-SUFFIX,cloudflare.com,Core
  - DOMAIN-SUFFIX,twitter.com,Core
  - DOMAIN-SUFFIX,telegram.org,Core
  - DOMAIN-SUFFIX,t.me,Core
  - PROCESS-NAME,com.google.uid.shared,Core
  - PROCESS-NAME,org.telegram.messenger.web,Core 
  - GEOIP,IR,DIRECT
  - MATCH,Core
